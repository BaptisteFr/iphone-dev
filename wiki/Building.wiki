#summary How to build the toolchain.

=HOWTO=

 * Get a copy of the iPhone root filesystem, unpack it somewhere, and set the environment variable `$HEAVENLY` to its path.
{{{
$ export HEAVENLY=/path/to/filesystem
}}}

 * Check out a copy of LLVM _SVN_, and build a _release_ build (as opposed to a debug one).
{{{
$ svn co http://llvm.org/svn/llvm-project/llvm/trunk llvm-svn
$ pushd llvm-svn
$ ./configure --enable-optimized
$ make ENABLE_OPTIMIZED=1
$ sudo make install
$ export LLVMOBJDIR=`pwd`
$ popd
}}}

 * Check out a copy of the iphone-dev SVN repository.
{{{
$ svn checkout http://iphone-dev.googlecode.com/svn/trunk/ iphone-dev
$ pushd iphone-dev
}}}

 * Make a directory to hold the toolchain.
{{{
$ sudo mkdir /usr/local/arm-apple-darwin
}}}

 * Build odcctools.
{{{
$ pushd odcctools
$ ./configure --target=arm-apple-darwin --disable-ld64
$ make
$ sudo make install
$ popd
}}}

 * Install the iPhone headers to the appropriate place.
{{{
$ pushd include
$ ./configure --host=arm-apple-darwin --prefix=/usr/local/arm-apple-darwin
$ make
$ sudo make install
$ popd
}}}

 * Install csu, which includes `crt1.o`, `dylib1.o`, and `bundle1.o`. Don't rebuild them from source, as this requires a working cross-GCC, which you don't have yet (and the build-from-source process is broken right now anyway). Binaries are provided for this reason.
{{{
$ pushd csu
$ ./configure --host=arm-apple-darwin --prefix=/usr/local/arm-apple-darwin
$ sudo make install
$ popd
}}}

 * Fill your installation of LLVM-GCC. Make sure that your Internet connection is up, and execute:
{{{
$ ./fill-llvm-gcc.sh
}}}

 * Find the location of your system C++ include headers, and put that path in `$CXXHEADERPATH`.
{{{
$ CXXHEADERPATH=/usr/include/c++/4.*.*
}}}

 * Prepare to install LLVM-GCC. Make sure that `$LLVMOBJDIR` and `$HEAVENLY` are set per the instructions above.
{{{
$ mkdir llvm-gcc-iphone-build
$ pushd llvm-gcc-iphone-build
$ EXTRALANGS=,objc,obj-c++
$ TARGETOPTIONS="--with-gxx-include-dir=$CXXHEADERPATH --target=arm-apple-darwin \
--enable-sjlj-exceptions --with-heavenly=$HEAVENLY --with-as=/usr/local/bin/arm-apple-darwin-as \
--with-ld=/usr/local/bin/arm-apple-darwin-ld"
$ BUILDOPTIONS=LLVM_VERSION_INFO=2.0-svn-iphone-dev-0.3-svn
}}}

 * Configure and make LLVM-GCC.
{{{
$ ../llvm-gcc-iphone/configure --enable-llvm=$LLVMOBJDIR --enable-languages=c,c++$EXTRALANGS $TARGETOPTIONS
$ make $BUILDOPTIONS
$ sudo make install
$ popd
$ popd
}}}

 * Download a copy of libstdcxx from [http://www.opensource.apple.com/darwinsource/]. Unpack it, and create a virtual GCC environment for it to build in.
{{{
$ pushd libstdcxx-11
$ mkdir libstdcxx-build
$ pushd libstdcxx-build
$ mkdir gcc
$ ln -s /usr/local/arm-apple-darwin/bin/xgcc ./gcc/xgcc
$ ln -s /usr/local/arm-apple-darwin/bin/g++ ./gcc/g++
}}}

 * Now build libstdcxx.
{{{
$ ../libstdcxx/configure --host=arm-apple-darwin --target=arm-apple-darwin --enable-sjlj-exceptions
$ make
$ sudo make install
$ popd
$ popd
}}}

 * You're done. Have fun!